#
# switch on/off TVout
# must properly resize the framebuffer for othe display given by hardware
#

MUX=$(expr "$(cat /proc/cmdline)" : ".*mux=\([^ ]*\)")

if [ "$1" == "1" ]
then # LCD -> TVout

echo 0 > /sys/devices/platform/omapdss/overlay0/enabled
echo "" > /sys/devices/platform/omapdss/overlay0/manager
echo 0 > /sys/devices/platform/omapdss/display2/enabled
echo "pal" > /sys/devices/platform/omapdss/display1/timings
fbset -fb /dev/fb0 -xres 720 -yres 574 -vxres 480 -vyres 640
echo 1 > /sys/devices/platform/omapdss/display1/enabled
echo "tv" > /sys/devices/platform/omapdss/overlay0/manager
echo 120,-33 > /sys/devices/platform/omapdss/overlay0/position
echo 1 > /sys/devices/platform/omapdss/overlay0/enabled

else # TVout -> LCD

echo 0 > /sys/devices/platform/omapdss/overlay0/enabled
echo 0,0 > /sys/devices/platform/omapdss/overlay0/position
echo "" > /sys/devices/platform/omapdss/overlay0/manager
echo 0 > /sys/devices/platform/omapdss/display1/enabled
case "$MUX" in
	GTA04B3 )	# WVGA landscape
		fbset -fb /dev/fb0 -xres 800 -yres 480 -vxres 800 -vyres 480
		;;
	* )	# VGA portrait
		fbset -fb /dev/fb0 -xres 480 -yres 640 -vxres 480 -vyres 640
		;;
esac
echo 1 > /sys/devices/platform/omapdss/display2/enabled
echo "lcd" > /sys/devices/platform/omapdss/overlay0/manager
echo 1 > /sys/devices/platform/omapdss/overlay0/enabled

fi
