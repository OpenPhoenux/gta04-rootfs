#
# Copyright Golden Delicious Computers GmbH&Co. KG, 2010
# licenced unter GPL 2.0
#
# this is part of OM Beagle Hybrid / GTA04
# it is derived from http://elinux.org/BeagleBoardDebian
#
# run this script after first install to upgrade the bootstrapped image to a useful image
# it should be safe to re-run it
#

depmod -a

## FIXME: we should set the clock to the changed date of this postinst file!
( ps -ef | fgrep -v fgrep | fgrep -q ntpd ) || date 010100002011 # get rid of 'in the future' warnings from tar and apt-get until we have ntp

apt-get update || exit 1	# get latest package list
dpkg --configure -a	# try to cleanup if previous attempt failed
apt-get install -y --force-yes debian-archive-keyring
apt-get update		# get latest package list again
apt-get install -y apt-utils

# WARNING: this line opens a big security hole but simplifies development

sed -i 's/\(PermitEmptyPasswords\) no/\1 yes/' $DEST/etc/ssh/sshd_config
# sed -i 's/\(PermitEmptyPasswords\) yes/\1 no/' $DEST/etc/ssh/sshd_config

#
# install useful tools
#

./useful

#
# save a snapshot of the resulting system (copy from this SD to some medium to make clones)
#

# (cd / && tar cvjf debian-lxde.tbz --exclude debian-lxde.tbz --exclude proc  -- exclude /sys . )

# rm postinst

echo postinst done.
